version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - echo "Listing directory structure for debugging:"
        - ls -la
        - echo "Current working directory is $(pwd)"
        - echo "Starting build process..."
        - NODE_ENV=production npm run build
        - echo "Build completed, preparing standalone output..."
        - mkdir -p .next/standalone/.next
        - cp -R .next/static .next/standalone/.next/
        - cp -R public .next/standalone/ || echo "No public directory found, skipping..."
        - cp server.js .next/standalone/
        - echo "Final standalone directory structure:"
        - ls -la .next/standalone/
  artifacts:
    baseDirectory: .next/standalone
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/* 